# 🧠 Google Drive Knowledge Integration

## סיכום

המערכת כעת מחוברת ל-**Google Drive** כמקור הידע המרכזי ומשתמשת ב-**AI (Gemini + OpenAI)** לעיבוד חכם של המידע.

---

## 🎯 איך זה עובד?

### 1️⃣ **המשתמש שואל שאלה**
```
"תן לי מידע על הסטוק"
"מה הבריף האחרון של ערב טוב?"
"הצעת מחיר לאורגניה"
```

### 2️⃣ **Knowledge Retriever מבין את השאילתה**

באמצעות **Gemini AI**, המערכת:
- ✅ מחלצת שמות לקוחות מהטקסט
- ✅ מזהה כוונת החיפוש (בריף/הצעה/מידע כללי)
- ✅ בונה מילות מפתח חכמות

**דוגמה:**
```typescript
Input: "תן לי את הבריף של הסטוק"

Output: {
  clientNames: ["הסטוק"],
  keywords: ["בריף", "הסטוק"],
  intent: "בריף"
}
```

### 3️⃣ **חיפוש ב-Google Drive**

המערכת:
- 🔍 מחפשת תיקיות בשם הלקוח
- 📂 סורקת את כל הקבצים בתיקיות
- 📄 מזהה מסמכים חשובים (בריפים, הסכמים, הצעות)

### 4️⃣ **עיבוד חכם עם AI**

לכל מסמך, ה-AI:
- 📝 **מסכם** את התוכן (אם הוא ארוך)
- 🏷️ **מחלץ נתונים מובנים**:
  - שם לקוח
  - שם פרויקט
  - תקציב
  - תאריכים
  - אנשי קשר
  - נקודות מפתח

**דוגמה:**
```typescript
Document: "בריף ראשוני - נבחרת הסטוק 2023"

Extracted: {
  clientName: "הסטוק",
  projectName: "נבחרת 2023",
  budget: "לא צוין",
  dates: ["2023"],
  contacts: [],
  keyPoints: [
    "קמפיין שנתי",
    "יוצרי תוכן",
    "מדיה חברתית"
  ]
}
```

### 5️⃣ **דירוג לפי רלוונטיות**

ה-AI **מדרג** את המסמכים לפי רלוונטיות לשאילתה:
```
1. בריף ראשוני ← הכי רלוונטי
2. הצעת מחיר
3. טבלת שליטה
```

### 6️⃣ **הסוכן מקבל מידע מסודר**

הסוכן (Media/Sales/etc.) מקבל **KnowledgePack** מוכן:
```typescript
{
  ready: true,
  documents: [
    {
      title: "בריף ראשוני - נבחרת הסטוק 2023",
      content: "סיכום: קמפיין שנתי עם יוצרי תוכן...",
      tags: ["בריף", "הסטוק", "קמפיין שנתי"],
      url: "https://drive.google.com/..."
    },
    // ... עוד מסמכים
  ],
  confidence: 0.9
}
```

---

## 🔧 טכנולוגיות

### מקורות ידע:
- **Google Drive API** - גישה לקבצים ותיקיות
- **Google Docs API** - קריאת מסמכים
- **Google Sheets API** - קריאת גיליונות

### עיבוד AI:
- **Gemini 3 Pro** - ניתוח, הבנה, חילוץ entities
- **OpenAI GPT-5.2** - סיכומים, כתיבה מקצועית

---

## 📦 קבצים שנוצרו

```
src/knowledge/
├── drive-knowledge-source.ts          # חיבור ל-Drive + חילוץ תוכן
├── smart-knowledge-processor.ts       # עיבוד חכם עם AI
├── retriever.ts                       # Orchestrator של הידע
└── embedder.ts                        # Vector embeddings (עתידי)
```

---

## 🚀 איך להשתמש?

### מהסוכנים:
```typescript
import { retrieveKnowledge } from '../knowledge/retriever.js';

// הסוכן מבקש מידע
const knowledgePack = await retrieveKnowledge(
  "מידע על הסטוק",
  job.id,
  { clientId: job.clientId }
);

if (!knowledgePack.ready) {
  return failure("לא ניתן לבצע משימה בלי ידע");
}

// עכשיו יש לסוכן את כל המידע!
const documents = knowledgePack.documents;
```

### מה-CLI (לבדיקה):
```bash
pnpm cli run "תן לי מידע על הסטוק"
```

---

## 🎯 יתרונות

### ✅ **אינטליגנטי**
- המערכת מבינה שאילות בשפה טבעית
- לא צריך חיפוש מדויק
- זיהוי אוטומטי של לקוחות

### ✅ **מדויק**
- חילוץ ישיר מ-Drive
- אין המצאת מידע
- קישורים למקור

### ✅ **מסודר**
- סיכומים קצרים
- נקודות מפתח
- דירוג לפי רלוונטיות

### ✅ **מהיר**
- עיבוד מקביל
- קאשינג של נתונים
- שימוש חכם ב-APIs

---

## 🔐 הגדרות נדרשות

בקובץ `.env.local`:

```bash
# Google Drive
GOOGLE_SERVICE_ACCOUNT_KEY='{"type":"service_account",...}'

# AI Providers
GEMINI_API_KEY=AIza...
OPENAI_API_KEY=sk-...
```

### 📋 הרשאות נדרשות ב-Google Console:

1. **Google Drive API** - חיפוש וקריאת קבצים
2. **Google Docs API** - קריאת מסמכים
3. **Google Sheets API** - קריאת גיליונות

---

## 🧪 בדיקה

הרץ:
```bash
pnpm tsx test-google-simple.ts
```

זה יבדוק:
- ✅ חיבור ל-Drive
- ✅ חיפוש תיקיות
- ✅ רישום קבצים

---

## 📊 דוגמת תוצאה

```
🔍 מחפש: "הסטוק"

✅ נמצאו 5 תיקיות:
   1. נבחרת הסטוק
   2. הסטוק 2023
   3. הסכמים לידרס X הסטוק
   ...

📄 מעבד מסמכים:
   ✓ בריף ראשוני - נבחרת הסטוק 2023
   ✓ הצעת מחיר הסטוק יוצרות תוכן
   ✓ טבלת שליטה 2024

📊 סיכום:
   📁 תיקיות: 5
   📄 מסמכים: 12
   🧠 עיבוד AI: הושלם
   ⭐ Confidence: 0.95
```

---

## 🔮 צעדים הבאים

1. **✅ הושלם**: חיבור Drive + AI
2. **📌 הבא**: אינדוקס אוטומטי ל-Vector DB
3. **📌 עתידי**: OCR ל-PDFs + תמונות
4. **📌 עתידי**: Real-time sync עם Drive

---

## 💡 טיפים

### שיתוף תיקיות עם ה-Service Account:
```
1. לך ל-Drive שלך
2. לחץ ימני על תיקייה → Share
3. הוסף: ldrsagent@ldrsgroup-484815.iam.gserviceaccount.com
4. תן הרשאת Viewer
```

### מבנה תיקיות מומלץ:
```
Drive/
├── לקוחות/
│   ├── הסטוק/
│   │   ├── בריפים/
│   │   ├── הצעות/
│   │   └── תשלומים/
│   ├── ערב טוב/
│   └── ...
└── תבניות/
```

---

## ❓ שאלות נפוצות

**Q: האם המערכת יכולה לקרוא PDFs?**  
A: כרגע רק Google Docs ו-Sheets. PDF דורש integration נוסף (OCR).

**Q: מה קורה אם לקוח לא קיים ב-Drive?**  
A: המערכת מחזירה `knowledgePack.ready = true` אבל עם `status: 'empty'` והסוכן יודע שאין מידע.

**Q: האם המערכת שומרת קאש?**  
A: לא כרגע, כל בקשה הולכת ל-Drive. בעתיד נוסיף Vector DB לקאשינג.

**Q: כמה זמן לוקח חיפוש?**  
A: ~2-5 שניות (תלוי בגודל התיקיות וכמות המסמכים).

---

🎉 **המערכת מוכנה לשימוש!**
